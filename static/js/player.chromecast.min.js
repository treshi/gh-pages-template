var timer=null,session=null,progressFlag=1,currentMedia=null,currentMediaURL=null,currentMediaTime=0,currentVolume=1,currentPlaylist=null,currentPlaylistItem=null;
function getQueryParams(){var a=window.location.search.substring(1);if(""===a)return{};var c=encodeURI(a),b=decodeURIComponent(a),d={},g=!1,f=!1;if(-1!=b.indexOf("http://")||-1!=b.indexOf("https://"))if(-1!=b.indexOf("?")&&(f=!0),-1!=c.indexOf("http%253A%252F%252F")||-1!=c.indexOf("https%253A%252F%252F"))g=!0;c=f?g?c.split("&"):encodeURIComponent(a).split("%26"):b.split("&");if(c.length)for(b=0;b<c.length;b++){var h=c[b],e=h.split("="),k=decodeURIComponent(e[0]),e=e[1];"undefined"===typeof e&&(e=
h.split("%3D"),k=decodeURIComponent(e[0]),e=e[1]);if(-1!=e.indexOf("http%253A%252F%252F")||-1!=e.indexOf("https%253A%252F%252F"))e=decodeURIComponent(e);e=decodeURIComponent(e);f&&!g&&-1!=e.indexOf("?")&&(h=(new RegExp(""+regexEscape(e)+"=(\\w+)&")).exec(a))&&h.length&&(e+="="+h[1]);d[k]=e}return d}chrome.cast&&chrome.cast.isAvailable||setTimeout(initializeCastApi,1E3);
function initializeCastApi(){var a=new chrome.cast.SessionRequest("AC2C6EBA"),a=new chrome.cast.ApiConfig(a,sessionListener,receiverListener);chrome.cast.initialize(a,onInitSuccess,onError)}function onInitSuccess(){console.log("init success")}function onError(){console.log("error")}function onSuccess(a){console.log(a)}function onStopAppSuccess(){console.log("Session stopped")}
function sessionListener(a){session=a;console.log("New session ID: "+session.sessionId);0!=session.media.length&&(console.log("Found "+session.media.length+" existing media sessions."),onMediaDiscovered("sessionListener",session.media[0]),loadSessionVolume(),session.media[0].media.contentId&&setStreamUrl(session.media[0].media.contentId));session.addMediaListener(onMediaDiscovered.bind(this,"addMediaListener"));session.addUpdateListener(sessionUpdateListener.bind(this))}
function sessionUpdateListener(a){console.log((a?"Session Updated":"Session Removed")+(": "+session.sessionId));a||(session=null,a=document.getElementById("playpauseresume"),a.innerHTML="Play",timer?clearInterval(timer):(timer=setInterval(updateCurrentTime.bind(this),1E3),a.innerHTML="Pause"))}function receiverListener(a){"available"===a?console.log("receiver found"):console.log("receiver list empty")}function setMyMediaURL(a){a.value&&(currentMediaURL=a.value)}
function launchApp(){console.log("launching app...");chrome.cast.requestSession(onRequestSessionSuccess,onLaunchError);timer&&clearInterval(timer)}
function onRequestSessionSuccess(a){console.log("session success: "+a.sessionId);session=a;session.addUpdateListener(sessionUpdateListener.bind(this));0!=session.media.length&&onMediaDiscovered("onRequestSession",session.media[0]);session.addMediaListener(onMediaDiscovered.bind(this,"addMediaListener"));session.addUpdateListener(sessionUpdateListener.bind(this))}function onLaunchError(){console.log("launch error")}
function stopApp(){session.stop(onStopAppSuccess,onError);timer&&clearInterval(timer)}function loadCustomMedia(){var a=document.getElementById("networkStreamUrl").value,c=document.getElementById("mediaMimeType").value;0<a.length&&loadMediaPwnt(a,c)}function playCustomMedia(){var a=document.getElementById("networkStreamUrl").value;0<a.length&&(document.location.href="player.html?fullscreen=1&autostart=1&video="+a)}
function toggleChannels(){document.getElementById("iptv-list").style.display="none"==document.getElementById("iptv-list").style.display?"block":"none";return!1}
function setLivestream(a){(a="http://live-lh.daserste.de/i/daserste_de@91204/index_2692_av-p.m3u8?b=2692&sd=10&dw=10&rebase=on http://zdf1314-lh.akamaihd.net/i/de14_v1@392878/index_3056_av-p.m3u8?b=3056&sd=10&dw=10&rebase=on http://zdf1314-lh.akamaihd.net/i/de13_v1@392882/index_3056_av-p.m3u8?b=3056&sd=10&dw=10&rebase=on http://zdf1112-lh.akamaihd.net/i/de12_v1@392882/index_3056_av-p.m3u8?b=3056&sd=10&dw=10&rebase=on http://zdf0910-lh.akamaihd.net/i/de09_v1@392871/index_1456_av-b.m3u8?b=1456&sd=10&rd=10&rebase=on http://zdf0910-lh.akamaihd.net/i/dach10_v1@392872/index_1456_av-b.m3u8?b=1456&sd=10&rd=10&rebase=on http://wdr_fs_geo-lh.akamaihd.net/i/wdrfs_geogeblockt@112044/index_3776_av-p.m3u8?b=3776&sd=10&rd=10&rebase=on http://ardevent2geo.wdr.de/i/wdrardevent2_geogeblockt@112050/index_3776_av-p.m3u8?sd=10&rebase=on http://emwdr-lh.akamaihd.net/i/em2016_wdr@182638/index_3776_av-p.m3u8?b=3667&sd=10&dw=10&rebase=on http://tagesschau-lh.akamaihd.net/i/tagesschau_1@119231/index_3776_av-p.m3u8?sd=10&rebase=on http://ndr_fs-lh.akamaihd.net/i/ndrfs_nds@119224/master.m3u8 http://delive.artestras.cshls.lldns.net/artestras/delive/delive.m3u8 http://ran01de-live.hls.adaptive.level3.net/sevenone/ran01de/wifi2500.m3u8 http://ran03dach-live.hls.adaptive.level3.net/sevenone/ran03dach/wifi2500.m3u8".split(" ")[a])&&setStreamUrl(a);
return!1}function setStreamUrl(a){a&&(document.getElementById("networkStreamUrl").value=a,guessMimeType(a));return!1}function getMediaFilename(a){return a.split("/").pop()}
function createVideoPlaylist(a){var c=a.split(";");a=[];var b;for(b=0;b<c.length;b++){var d=c[b];isMediaUrl(d)&&a.push(d)}if(a.length)for(currentPlaylist=a,currentPlaylistItem=0,c=document.getElementById("playlist"),document.getElementById("playlist-wrapper").style.display="block",b=0;b<a.length;b++){var d=a[b],g=document.createElement("li"),f=document.createElement("a");f.textContent=getMediaFilename(d);f.href="#";f.className="playlist-item";f.setAttribute("data-url",d);f.addEventListener("click",
function(a){a.preventDefault();setStreamUrl(this.getAttribute("data-url"));return!1});g.appendChild(f);c.appendChild(g)}}
function setPlaylistCurrentItem(a){var c=document.querySelectorAll(".playlist-item"),b;for(b=0;b<c.length;b++){var d=c[b],g=d.getAttribute("data-url"),d=d.parentNode;if(!a&&2==d.childNodes.length)d.removeChild(d.childNodes[1]);else if(session&&session.media[0]&&g==session.media[0].media.contentId&&-1==d.innerHTML.indexOf("[CURRENTLY PLAYING]")){a=document.createElement("code");a.textContent=" [CURRENTLY PLAYING]";d.appendChild(a);currentPlaylistItem=b;break}}}
function isMediaUrl(a){return-1==a.indexOf("http://")&&-1==a.indexOf("https://")||-1==a.indexOf(".mp4")&&-1==a.indexOf(".mkv")&&-1==a.indexOf(".m3u8")&&-1==a.indexOf(".mp3")?!1:!0}function toHHMMSS(a){a=new Date(Math.round(100*a)/100*1E3);return("0"+a.getUTCHours()).slice(-2)+":"+("0"+a.getUTCMinutes()).slice(-2)+":"+("0"+a.getSeconds()).slice(-2)}
function guessMimeType(a){-1!=a.indexOf(".mp3")?document.getElementById("mediaMimeType").selectedIndex=2:-1!=a.indexOf(".mp4")||-1!=a.indexOf(".mkv")?document.getElementById("mediaMimeType").selectedIndex=1:-1!=a.indexOf(".m3u8")&&(document.getElementById("mediaMimeType").selectedIndex=0)}
function guessMimeTypeStr(a){if(a&&a.length){if(-1!=a.indexOf(".mp3"))return"audio/mpeg";if(-1!=a.indexOf(".mp4")||-1!=a.indexOf(".mkv"))return"video/mp4";if(-1!=a.indexOf(".m3u8"))return"application/vnd.apple.mpegurl"}else return!1}
function loadMedia(a){if(session){a=a?a:currentMediaURL;var c=new chrome.cast.media.MediaInfo(a);console.log("loading new media file... "+a);c.contentType="video/mp4";a=new chrome.cast.media.LoadRequest(c);a.autoplay=!0;a.currentTime=0;session.loadMedia(a,onMediaDiscovered.bind(this,"loadMedia"),onMediaError)}else console.log("no session")}
function loadMediaPwnt(a,c){if(session){var b=a?a:currentMediaURL,d=new chrome.cast.media.MediaInfo(b);console.log("loading new media file... "+b);d.contentType=c;b=new chrome.cast.media.LoadRequest(d);b.autoplay=!0;b.currentTime=0;session.loadMedia(b,onMediaDiscovered.bind(this,"loadMedia"),onMediaError)}else console.log("no session")}
function onMediaDiscovered(a,c){console.log("new media session ID:"+c.mediaSessionId);currentMedia=c;currentMedia.addUpdateListener(onMediaStatusUpdate);currentMediaTime=currentMedia.currentTime;playpauseresume.innerHTML="Play";timer||(timer=setInterval(updateCurrentTime.bind(this),1E3),playpauseresume.innerHTML="Pause")}function onMediaError(a){console.log("media error")}
function onMediaStatusUpdate(a){progressFlag&&(document.getElementById("duration").innerHTML=toHHMMSS(currentMedia.media.duration),document.getElementById("progress_tick").innerHTML=toHHMMSS(currentMedia.currentTime),document.getElementById("progress").value=(100*currentMedia.currentTime/currentMedia.media.duration).toFixed(2));document.getElementById("playerstate").innerHTML=currentMedia.playerState}
function loadSessionVolume(){session&&session.receiver.volume.level?(currentVolume=session.receiver.volume.level,document.getElementById("volumething").value=100*session.receiver.volume.level):(currentVolume=1,document.getElementById("volumething").value=100)}setInterval(function(){var a=document.getElementById("playpauseresume");currentMedia&&"PLAYING"==currentMedia.playerState&&"Play"==a.innerHTML&&playMedia()},1E3);
function updateCurrentTime(){if(session&&currentMedia)if(currentMedia.media&&null!=currentMedia.media.duration){var a=currentMedia.getEstimatedTime(),c=(100*a/currentMedia.media.duration).toFixed(2);document.getElementById("progress").value=c;document.getElementById("progress_tick").innerHTML=toHHMMSS(a);setPlaylistCurrentItem(!0);"IDLE"==currentMedia.playerState&&"FINISHED"==currentMedia.idleReason&&stopMedia()}else document.getElementById("progress").value=0,document.getElementById("progress_tick").innerHTML=
0,timer&&clearInterval(timer)}
function playMedia(){if(currentMedia){timer&&clearInterval(timer);var a=document.getElementById("playpauseresume");"Play"==a.innerHTML?(currentMedia.play(null,mediaCommandSuccessCallback.bind(this,"playing started for "+currentMedia.sessionId),onError),console.log("playback started..."),a.innerHTML="Pause",setPlaylistCurrentItem(!0),timer=setInterval(updateCurrentTime.bind(this),1E3)):"Pause"==a.innerHTML?(currentMedia.pause(null,mediaCommandSuccessCallback.bind(this,"paused "+currentMedia.sessionId),
onError),console.log("playback paused..."),a.innerHTML="Resume"):"Resume"==a.innerHTML&&(currentMedia.play(null,mediaCommandSuccessCallback.bind(this,"resumed "+currentMedia.sessionId),onError),console.log("playback resumed..."),a.innerHTML="Pause",timer=setInterval(updateCurrentTime.bind(this),1E3))}}
function stopMedia(){setPlaylistCurrentItem(!1);if(currentMedia&&(currentMedia.stop(null,mediaCommandSuccessCallback.bind(this,"stopped "+currentMedia.sessionId),onError),console.log("playback stopped"),document.getElementById("playpauseresume").innerHTML="Play",timer&&clearInterval(timer),null!=currentPlaylist&&0<currentPlaylist.length&&currentPlaylistItem<currentPlaylist.length-1)){setPlaylistCurrentItem(!1);var a=currentPlaylist[currentPlaylistItem+1];loadMediaPwnt(a,guessMimeTypeStr(a))}}
function setMediaVolume(a,c){if(currentMedia){var b=new chrome.cast.Volume,d=new chrome.cast.media.VolumeRequest;b.muted=c;b.level=a;d.volume=b;currentVolume=b.level;currentMedia.setVolume(d,mediaCommandSuccessCallback.bind(this,"media set-volume done"),onError)}}
function setReceiverVolume(a,c){session&&(c?session.setReceiverMuted(!0,mediaCommandSuccessCallback.bind(this,"media set-volume done"),onError):(session.setReceiverVolumeLevel(a,mediaCommandSuccessCallback.bind(this,"media set-volume done"),onError),currentVolume=a),setTimeout(function(){currentMedia.volume.level=currentVolume;currentMedia.volume.sessionVolume=100*currentVolume;document.getElementById("volumething").value=100*currentVolume},300))}
function muteMedia(a){1==a.checked?(setReceiverVolume(currentVolume,!0),console.log("media muted"),a.checked=!0):(setReceiverVolume(currentVolume,!1),console.log("media unmuted"))}function seekMedia(a){console.log("Seeking "+currentMedia.sessionId+":"+currentMedia.mediaSessionId+" to "+a+"%");progressFlag=0;var c=new chrome.cast.media.SeekRequest;c.currentTime=a*currentMedia.media.duration/100;currentMedia.seek(c,onSeekSuccess.bind(this,"media seek done"),onError)}
function onSeekSuccess(a){console.log(a);setTimeout(function(){progressFlag=1},1500)}function mediaCommandSuccessCallback(a){console.log(a)};
